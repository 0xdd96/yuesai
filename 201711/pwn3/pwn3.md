# 2017_11_pwn3


## get到的知识点
<br>
&#8195;首先去学习了一下32位的原题，感觉学到了很多<br>
&#8195;1、setbuf函数的利用<br>
&#8195;setbuf是将文件与缓冲区关联起来，在写文件时，先将其写入缓冲区中，当缓冲区指针超过某一值时就会写入文件。通过合适的构造就可以溢出栈。<br>
<br>
&#8195;2、rop链的构造<br>
&#8195;这里通过一次栈溢出来完成所有的操作，利用了程序中自带的read_n函数来获取第二次输入<br>
<br>
&#8195;3、改写栈地址<br>
&#8195;通过两个gadget来完成，首先通过pop ebp；ret改写ebp，然后通过leave ret，改写esp<br>

## 遇到的错误
<br>
&#8195;这里仿照32位的构造方式，来编写64位的exp，开始以为只要改变参数的传递方式就ok，没想到还是忽略了一些小细节，主要错误如下：<br>
 
### 错误1 执行quit操作失败
<br>
&#8195;主要是因为覆盖时将循环控制变量赋值为非空，导致循环直接退出了，因此不需要执行quit操作，否则需要执行quit操作<br>

### 错误2 rop链传送截断
<br>
&#8195;如下是构造的rop链的16进制表示，可以看到中间存在0x0a，read_n函数在读取时遇到0xa是要截断的

 ```
 616161616161616161616161616161616161616161616161616161616161616161b30f40000000000040206000000000000007400000000000b30f4000000000000020600000000000b10f40000000000000010000000000006161616161616161a10a400000000000e0074000000000000020600000000000bc08400000000000
 ```

&#8195;因此，这里不能简单的直接写，可以通过xor操作编码，再利用程序中的xor操作解码<br>

### 错误3 改写的栈位置不合适
<br>
&#8195;查看进程可以读写的地址空间如下

 ```
 0x00602000         0x00603000         rw-p	/root/Desktop/my_ctf/2017-11yuesai/pwn3/tucao_service
 ```

&#8195;开始将栈地址改为0x00602200，结果在运行system(‘/bin/sh’)时出错，后来改为0x00602300正确，根据原题wp中作者的分析，我感觉第二种可能性比较大，也就是system的栈地址空间不够<br>
 

 
